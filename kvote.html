<!doctype html>
<html lang="sr">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kvote vizuelno ‚Ä¢ Luka (v9 ‚Äì auto 10s + datum/vreme u naslovu)</title>
<style>
  :root{ --bg:#0a0e1a; --card:#161b2e; --muted:#9aa3b2; --txt:#e8ecf5; --line:#232842; --accent:#6b8aff; --accent-2:#5fead7; --good:#2dd4bf; --good-ink:#042f2e; --bad:#f87171; --bad-ink:#450a0a; --pill:#1e293b; --best-ring:#fef3c7; --hover-glow:rgba(107,138,255,0.15); }
  *{box-sizing:border-box}
  body{margin:0; font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; background:var(--bg); color:var(--txt); background-image:radial-gradient(circle at 20% 50%, rgba(107,138,255,0.05) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(95,234,215,0.05) 0%, transparent 50%);}
  .wrap{max-width:1200px; margin:24px auto 48px; padding:0 20px}
  header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(12px); background:linear-gradient(180deg, rgba(10,14,26,.92), rgba(10,14,26,.75) 60%, transparent); border-bottom:1px solid rgba(107,138,255,0.1);} 
  .bar{display:flex; align-items:center; justify-content:center; gap:12px; padding:14px 20px; flex-wrap:nowrap;}
  h1{font-size:20px; margin:0; letter-spacing:.5px; font-weight:700; background:linear-gradient(135deg, var(--accent), var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; white-space:nowrap;}
  .spacer{flex:1}
  button{border:1px solid var(--line); background:linear-gradient(135deg, #1e293b, #1c2240); color:#fff; padding:8px 16px; border-radius:10px; cursor:pointer; transition:.2s all; font-size:13px; font-weight:600; box-shadow:0 2px 8px rgba(0,0,0,0.3);}
  button:hover{background:linear-gradient(135deg, #242b53, #2a3254); transform:translateY(-1px); box-shadow:0 4px 12px rgba(107,138,255,0.2);} 
  button:active{transform:translateY(0px)}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:5px 12px; border-radius:999px; background:var(--pill); color:#fff; font-size:11px; border:1px solid var(--line); white-space:nowrap; font-weight:600; box-shadow:0 2px 4px rgba(0,0,0,0.2);}
  .pill.good{background:linear-gradient(135deg, var(--good), #14b8a6); color:var(--good-ink); box-shadow:0 2px 8px rgba(45,212,191,0.3);}
  .pill.bad{background:linear-gradient(135deg, var(--bad), #ef4444); color:var(--bad-ink); box-shadow:0 2px 8px rgba(248,113,113,0.3);}
  .controls{display:grid; grid-template-columns:1fr; gap:12px; margin:20px 0 12px}
  @media(min-width:1200px){.controls{grid-template-columns:.8fr .9fr auto}}
  .in{background:rgba(12,15,36,0.8); color:var(--txt); border:1px solid var(--line); border-radius:12px; padding:12px 14px; transition:.2s all; backdrop-filter:blur(8px);}
  .in:focus{outline:none; border-color:var(--accent); box-shadow:0 0 0 3px var(--hover-glow);}
  textarea.in{height:140px; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; display:none}
  .small{font-size:12px; color:var(--muted); font-weight:500;}
  .content-wrapper{display:flex; gap:24px; align-items:flex-start}
  .sidebar{flex:0 0 240px; position:sticky; top:90px; background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; max-height:calc(100vh - 110px); overflow-y:auto; box-shadow:0 8px 24px rgba(0,0,0,0.3); backdrop-filter:blur(8px);}
  .sidebar h3{margin:0 0 12px; font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:.8px; font-weight:700;}
  .league-item{padding:10px 12px; margin:6px 0; border-radius:10px; cursor:pointer; font-size:13px; transition:.2s all; border:1px solid transparent; font-weight:500;}
  .league-item:hover{background:var(--hover-glow); border-color:rgba(107,138,255,0.3); transform:translateX(2px);}
  .league-item.active{background:linear-gradient(135deg,rgba(107,138,255,.25),rgba(95,234,215,.15)); border-color:var(--accent); font-weight:700; box-shadow:0 2px 8px var(--hover-glow);}
  .league-count{float:right; opacity:.7; font-size:11px; font-weight:700; background:rgba(107,138,255,0.2); padding:2px 8px; border-radius:999px;}
  .grid{display:grid; grid-template-columns:1fr; gap:20px; flex:1}
  @media(max-width:1000px){.sidebar{display:none}}
  .match{border:1px solid rgba(107,138,255,0.2); border-radius:20px; background:var(--card); overflow:hidden; box-shadow:0 8px 32px rgba(0,0,0,.4); transition:.3s all; backdrop-filter:blur(8px);}
  .match:hover{transform:translateY(-4px); box-shadow:0 12px 48px rgba(107,138,255,.3); border-color:rgba(107,138,255,0.4);}
  .head{display:flex; gap:12px; align-items:center; padding:18px; background:linear-gradient(135deg, rgba(107,138,255,.15), rgba(95,234,215,.1)); border-bottom:1px solid rgba(107,138,255,0.2);}
  .teams{font-weight:800; letter-spacing:.3px; font-size:16px;}
  .meta{margin-left:auto; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .sub{color:var(--muted); font-size:12px; margin-top:3px; font-weight:500;}
  .body{padding:16px 18px}
  .stats{display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:12px}
  .stat{border:1px solid rgba(107,138,255,0.2); border-radius:14px; padding:14px; background:linear-gradient(135deg,#171d3b,#121730); transition:.2s all; box-shadow:0 4px 12px rgba(0,0,0,0.3);}
  .stat:hover{transform:translateY(-2px); box-shadow:0 6px 20px rgba(107,138,255,0.2); border-color:rgba(107,138,255,0.4);}
  .stat h4{margin:0 0 8px; font-size:11px; text-transform:uppercase; letter-spacing:.8px; color:#b8c0d6; font-weight:700;}
  .big{font-size:24px; font-weight:900; background:linear-gradient(135deg, var(--accent), var(--accent-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;}
  .bk{opacity:.85; font-size:12px; margin-top:4px; font-weight:600;}
  .bk a{color:var(--accent); text-decoration:none; font-weight:600; transition:.2s all;}
  .bk a:hover{color:var(--accent-2); text-decoration:underline; text-shadow:0 0 8px rgba(107,138,255,0.4);}
  table{width:100%; border-collapse:collapse; margin-top:14px; overflow:auto}
  th,td{border-bottom:1px solid rgba(107,138,255,0.1); padding:10px 8px; text-align:left}
  thead th{position:sticky; top:0; background:linear-gradient(135deg, #151a33, #1a1f3a); z-index:1; font-weight:700; font-size:12px; text-transform:uppercase; letter-spacing:.5px; color:var(--accent-2);}
  td.num{text-align:right; font-variant-numeric:tabular-nums}
  td.num .cell{display:inline-block; padding:4px 8px; border-radius:8px; font-weight:600; transition:.2s all;}
  td.num .cell.best{outline:2px solid var(--best-ring); background:rgba(254,243,199,0.1); font-weight:900; box-shadow:0 0 12px rgba(254,243,199,0.3);}
  td a{color:var(--accent); text-decoration:none; font-weight:700; transition:.2s all; position:relative;}
  td a:hover{color:var(--accent-2); text-shadow:0 0 8px rgba(107,138,255,0.5);}
  td a::after{content:''; position:absolute; bottom:-2px; left:0; width:0; height:2px; background:linear-gradient(90deg, var(--accent), var(--accent-2)); transition:.3s all;}
  td a:hover::after{width:100%;}
  tr{transition:.2s all;}
  tr:hover{background:rgba(107,138,255,.08); transform:scale(1.01);}
  tr:hover td{background:transparent;}
  .footer{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:12px; padding:12px 18px; border-top:1px dashed rgba(107,138,255,0.2); font-weight:600;}
  .barwrap{height:6px; background:#0d1130; border-radius:6px; overflow:hidden; border:1px solid #0b0f29; margin-top:4px;}
  .bar{height:100%; width:0; transition:width .3s ease;}
</style>
<body>
  <header>
    <div class="wrap bar">
      <h1>Vizuelni prikaz kvota</h1>
      <span class="pill" id="pillStatus">status: spremno</span>
      <button id="btnPrint">≈†tampa / PDF</button>
    </div>
  </header>

  <div class="wrap">
    <div class="controls">
      <textarea id="src" class="in" placeholder="Uƒçitani tekst (read-only)"></textarea>
      <input id="q" class="in" placeholder="üîç Filtriraj po timu/ligi‚Ä¶"/>
      <select id="sort" class="in">
        <option value="arbdesc" selected>Sortiraj po profitu 1-X-2 (opadajuƒáe)</option>
        <option value="arbasc">Sortiraj po profitu 1-X-2 (rastuƒáe)</option>
        <option value="arb02desc">Sortiraj po profitu 0-2/3+ (opadajuƒáe)</option>
        <option value="arb02asc">Sortiraj po profitu 0-2/3+ (rastuƒáe)</option>
        <option value="time">Sortiraj po vremenu</option>
        <option value="none">Sortiranje: bez</option>
      </select>
      <div class="small">Automatsko uƒçitavanje svakih <b>5 minuta</b>.</div>
    </div>

    <div class="content-wrapper">
      <div class="sidebar" id="sidebar">
        <h3>Lige</h3>
        <div id="leagueList"></div>
      </div>
      <div id="out" class="grid"></div>
    </div>
  </div>

<script>
// === Pode≈°avanja ===
const DEFAULT_FILE = 'kvote_arbitraza_FULL.txt';
const AUTO_INTERVAL_MS = 300_000; // 5 minuta

// Globalna promenljiva za podatke
let currentData = [];

// === Mapa URL-ova kladionica ===
const BOOKMAKER_URLS = {
  'balkanbet': 'https://www.balkanbet.rs/sportsko-kladjenje/1-offer/18-fudbal',
  'betole': 'https://www.betole.com/sport/S/calendar',
  'brazil': 'https://www.brazilbet.rs/sr/vremenska-ponuda',
  'brazil_d': 'https://www.brazilbet.rs/sr/vremenska-ponuda',
  'brazil_p': 'https://www.brazilbet.rs/sr/vremenska-ponuda',
  'brazil_s': 'https://www.brazilbet.rs/sr/vremenska-ponuda',
  'meridian': 'https://meridianbet.rs/en/betting/football',
  'merkur': 'https://www.merkurxtip.rs/sr/sportsko-kladjenje/sledeci-mecevi',
  'mozzart': 'https://www.mozzartbet.com/sr/kladjenje/sport/1?date=all_days',
  'soccer': 'https://www.soccerbet.rs/sr/sportsko-kladjenje/fudbal/S',
  'topbet': 'https://www.topbet.rs/sportsko-kladjenje/1-offer/3-fudbal'
};

// === Mapa grupisanja liga po zemljama ===
const COUNTRY_LEAGUES = {
  'Poljska': ['POLAND, III Liga - Group I', 'POLAND, III Liga - Group II', 'POLAND, III Liga - Group III', 'POLAND, III Liga - Group IV', 'Polish - II Liga', 'Polish - III Liga', 'Polish - IV Liga', 'Poljska 1', 'Poland, III Liga - Group I', 'Poland, III Liga - Group II', 'Poland, III Liga - Group III', 'Poland, III Liga - Group IV', 'Poljska 2', 'Poljska 3'],
  'Engleska': ['Engleska 1', 'Engleska 2', 'Engleska 3', 'Engleska 4', 'Engleska 5', 'English - Isthmian League', 'English - National League South', 'English - Professional Development League', 'Engleska 7 Central', 'Engleska 7 Istok', 'Engleska 7 Jug', 'Engleska 7 Sever', 'Engleska 6 Jug', 'Engleska 6 Sever', 'England, Championship', 'English - Championship', 'English - EFL Cup', 'English - Premier League', 'English - Southern South'],
  'Nemaƒçka': ['German - Regionalliga Bayern', 'German - Regionalliga Nord', 'German - Regionalliga Nordost', 'German - Regionalliga Sudwest', 'German - Regionalliga West', 'Nemaƒçka 1', 'Nemaƒçka 2', 'Nemaƒçka 3', 'Nemaƒçka 4 Bavarija', 'Nemaƒçka 4 Jugozapad', 'Nemaƒçka 4 Sever', 'Nemaƒçka 4 Severoistok', 'Nemaƒçka 4 Zapad', 'German - Bundesliga', 'German - DFB Pokal', 'Germany, Regionalliga Bayern', 'Germany, Regionalliga Nordost', 'Germany, Regionalliga North', 'Germany, Regionalliga Sudwest', 'Germany, Regionalliga West'],
  'Italija': ['ITALY, Serie C - Group A', 'ITALY, Serie C - Group C', 'Italian - Coppa Italia', 'Italian - Supercoppa Italiana', 'Italija 1', 'Italija 2', 'Italija 3 - Grupa A', 'Italija 3 - Grupa B', 'Italija 3 - Grupa C', 'Italian - Serie A', 'Italian - Serie B', 'Italy, Serie C - Group A'],
  'Argentina': ['Argentina 1', 'Argentina, Primera C - Promotion - Play Offs', 'Argentine - Argentine Liga Profesional', 'Argentine - Argentine Primera Nacional', 'Argentine - Primera B', 'Argentina Kup'],
  'Holandija': ['Dutch - Eerste Divisie', 'Dutch - Eredivisie', 'Dutch - Tweede Divisie', 'Holandija 1', 'Holandija 2', 'Netherlands, Eerste Divisie'],
  '≈†kotska': ['Scottish - League Two', 'Scottish - Premiership', '≈†kotska 1', '≈†kotska 2', '≈†kotska 3'],
  'ƒåe≈°ka': ['Czech - CFL', 'Czech - National League', 'ƒåe≈°ka 1', 'ƒåe≈°ka 2', 'Czech Republic, ChNL', 'Czech Republic, MSFL'],
  'Danska': ['Danska 1', 'Danska 2', 'Danska 3', 'Danska 4', 'Danish - Danish Cup'],
  '≈†panija': ['Spanish - Spanish Primera RFEF', 'Spanish - Spanish Segunda RFEF', '≈†panija 1', '≈†panija 2', '≈†panija 3 - 1', '≈†panija 3 - 2', 'Spanish - La Liga'],
  'Turska': ['Turkish - First League', 'Turkish - Second League', 'Turska 1', 'Turska 2', 'TUR2', 'Turkey, Super Lig', 'Turkish - Super Lig'],
  'Austrija': ['Austrian - First League', 'Austrija 1', 'Austrija 2', 'Austrian - Bundesliga', 'Austrian - OFB Cup', 'AUT2'],
  'Belgija': ['Belgian - Belgium Reserve League', 'Belgija 1', 'Belgija 2', 'Belgian - First Division A', 'Belgian - First Division B', 'Belgium, Challenger Pro League'],
  'Brazil': ['Brazil 1', 'Brazil 2', 'Brazil 3', 'Brazilian - Serie A', 'Brazilian - Serie B'],
  'Bugarska': ['Bugarska 1', 'Bulgarian - First League', 'Bulgarian - Second League', 'Bulgaria, Vtora Liga'],
  'Evropa': ['European - Conference League', 'Liga Konferencija', 'Liga Konferencije', 'European - Champions League', 'European - Europa League', 'Liga Evrope', 'European - UEFA Nations League Women', 'European - UEFA Youth League', 'UEFA Liga Mladih', 'UEFA, Conference League - League phase'],
  'Japan': ['Japan 1', 'Japan 2', 'Japan 3'],
  'Kina': ['CHINA, Yi League - Relegation Group', 'Chinese - League Two', 'Kina 1', 'China, Super League', 'China, Yi League - Relegation Group'],
  'Litvanija': ['Lithuania, A Lyga', 'Lithuanian - A Lyga', 'Litvanija 1', 'Lithuania, I Lyga'],
  'Maƒëarska': ['Hungarian - NB I', 'Hungarian - NB II', 'Maƒëarska 1', 'MAƒê1'],
  'Meksiko': ['MEXICO, Liga de Expansion MX - Apertura', 'Meksiko 1', 'Meksiko 2', 'MEXICO, Liga MX - Apertura', 'Mexican - Liga MX', 'Mexico, Liga de Expansion MX - Apertura'],
  'Rusija': ['Rusija 1', 'Rusija 2', 'Russian - FNL', 'Rusija Kup', 'Russian - Cup', 'Russia, FNL', 'Russia,Youth League', 'Russian - Premier League'],
  'Saudijska Arabija': ['Saudi Arabia, Saudi Professional League', 'Saudi Arabian - Professional League', 'Saudijska Arabija 1', 'S. Arabija 1'],
  'Srbija': ['Serbian - Prva Liga', 'Serbian - Superliga', 'Srbija 1'],
  '≈†vajcarska': ['Swiss - Super League', '≈†vajcarska 1', '≈†vajcarska 2'],
  'Urugvaj': ['Uruguayan - Reserve League', 'Uruguayan - Segunda Division', 'Urugvaj 1'],
  'Australija': ['Australian - A-League', 'Australija 1', 'Australian - Australian Championship', 'Australija Championship', 'Australia, A-League'],
  'ƒåile': ['ƒåile 1', 'ƒåile 2', 'Chilean - Primera B', 'ƒåIL1'],
  'Egipat': ['Egipat 1', 'Egipat 2', 'Egyptian - Premier League', 'Egyptian - Second Division'],
  'Estonija': ['Estonia, Esiliiga', 'Estonian - Esiliiga'],
  'Etiopija': ['Ethiopia, Premier League', 'Ethiopian - Premier League'],
  'Finska': ['FINLAND, Ykkosliiga - Relegation', 'Finland, Ykkosliiga - Relegation', 'Finska 1', 'Finska 2', 'FINLAND, Veikkausliiga - Championship Group', 'Finnish - Veikkausliiga'],
  'Francuska': ['Francuska 1', 'Francuska 2'],
  'Hrvatska': ['Hrvatska 1', 'Hrvatska 2', 'Croatia, Prva NL'],
  'Island': ['ICELAND, Besta-deild karla - Relegation Group', 'Island 1', 'ISL1'],
  'Izrael': ['Izrael 1', 'Izrael 2', 'Israel, Leumit League', 'Israeli - Liga Leumit', 'Israeli - Ligat HaAl'],
  'Ju≈æna Koreja': ['Ju≈æna Koreja 1', 'Ju≈æna Koreja 2', 'KOL1'],
  'Letonija': ['Latvian - Virsliga', 'Letonija 1'],
  'Norve≈°ka': ['Norve≈°ka 1', 'Norve≈°ka 2', 'Norwegian - Eliteserien', 'Norwegian - First Division'],
  'Portugal': ['Portugal 1', 'Portugal 2'],
  'SAD': ['SAD 1', 'SAD 2', 'USA - Major League Soccer', 'USA - United Soccer League', 'USL1'],
  'Severna Irska': ['Severna Irska 1', 'Severna Irska 2'],
  '≈†vedska': ['≈†vedska 1', '≈†vedska 2', 'Swedish - Superettan', '≈†VE2', '≈†vedska 3 Sever', 'Sweden, Superettan', 'Swedish - Allsvenskan'],
  'Tajland': ['Tajland 1', 'Tajland 2', 'Thailand, Thai Premier League'],
  'Armenija': ['Armenia, Premier League'],
  'Azerbejd≈æan': ['Azerbaijan, Division One', 'Azerbaijani - First Division', 'Azerbaijani - Premier League'],
  'Banglade≈°': ['Bangladeshi - Federation Cup'],
  'Belorusija': ['Belorusija 1'],
  'BiH': ['BiH 1', 'Bosnian - First League', 'Bosnian - Premier League'],
  'Bolivija': ['Bolivian - Bolivian League Cup'],
  'Kostarika': ['Costa Rican - Segunda Division', 'Kostarika 1'],
  'Ekvador': ['Ecuador, Liga Pro - Championship Group', 'Ecuadorian - Primera Serie B', 'Ekvador 1'],
  'Farska Ostrva': ['Faroe Islands - Premier League'],
  'Gana': ['Ghana, Premier League'],
  'Grƒçka': ['Grƒçka 1', 'Greek - Cup', 'Greek - Superleague'],
  'Gvatemala': ['Guatemalan - Liga Nacional'],
  'Indonezija': ['Indonezija 1'],
  'Iran': ['Iran, Persian Gulf Pro League', 'Iranian - Gulf Pro League'],
  'Irak': ['Iraq, First Division'],
  'Irska': ['Ireland, Premier Division', 'Irska 1'],
  'Kanada': ['Kanada 1'],
  'Kazahstan': ['Kazakhstani - Premier League'],
  'Kipar': ['Kipar 1', 'KIP1'],
  'Kolumbija': ['Kolumbija 1', 'KRK1'],
  'Malta': ['Maltese - Premier League'],
  'Nikaragva': ['Nicaraguan - Primera Division', 'Nikaragva 1'],
  'Panama': ['Panamanian - LPF'],
  'Paragvaj': ['Paraguayan - Primera Division', 'Paragvaj 1', 'Paragvaj Kup'],
  'Peru': ['Peru 1', 'Peruvian - Primera Division'],
  'Katar': ['Qatari - Qatar Olympic League', 'Qatari - Stars League'],
  'Rumunija': ['Romanian - Cup', 'RUM1', 'Rumunija 1'],
  'Salvador': ['Salvador 1', 'Salvadoran - Primera Division'],
  'Slovaƒçka': ['Slovaƒçka 1'],
  'Slovenija': ['Slovenija 1'],
  'UAE': ['UAE - Presidents Cup', 'UAE - Reserve League'],
  'Uganda': ['Uganda, Premier League'],
  'Ukrajina': ['Ukraine, Premier League', 'Ukrainian - Premier League', 'Ukrajina 1'],
  'Uzbekistan': ['Uzbekistan 1'],
  'Vels': ['Vels 1', 'Welsh - Premier League'],
  'Afrika': ['African - African CAF Cup of Nations Women', 'African - CAF Confederation Cup', 'AFC Liga ≈†ampiona 2', 'African - CAF Champions League'],
  'CONCACAF': ['International Clubs, CONCACAF Central American Cup - Play Offs', 'KONKAKAF Cen.Ameriƒçki Kup', 'KONKAKAF Kup Kariba', 'North American - CONCACAF Caribbean Cup'],
  'Ju≈æna Amerika': ['South American - Copa Sudamericana', 'Kup Libertadores', 'Kup Sudamerikana'],
  'Meƒëunarodne': ['World - International Friendly', 'World - International Friendly Women']
};

// Funkcija koja pronalazi zemlju za ligu
function getCountryForLeague(leagueName) {
  for (const [country, leagues] of Object.entries(COUNTRY_LEAGUES)) {
    if (leagues.includes(leagueName)) {
      return country;
    }
  }
  return 'Ostalo';
}

// Mapa zastava za zemlje
const COUNTRY_FLAGS = {
  'Poljska': 'üáµüá±',
  'Engleska': 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',
  'Nemaƒçka': 'üá©üá™',
  'Italija': 'üáÆüáπ',
  'Argentina': 'üá¶üá∑',
  'Holandija': 'üá≥üá±',
  '≈†kotska': 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø',
  'ƒåe≈°ka': 'üá®üáø',
  'Danska': 'üá©üá∞',
  '≈†panija': 'üá™üá∏',
  'Turska': 'üáπüá∑',
  'Austrija': 'üá¶üáπ',
  'Belgija': 'üáßüá™',
  'Brazil': 'üáßüá∑',
  'Bugarska': 'üáßüá¨',
  'Evropa': 'üá™üá∫',
  'Japan': 'üáØüáµ',
  'Kina': 'üá®üá≥',
  'Litvanija': 'üá±üáπ',
  'Maƒëarska': 'üá≠üá∫',
  'Meksiko': 'üá≤üáΩ',
  'Rusija': 'üá∑üá∫',
  'Saudijska Arabija': 'üá∏üá¶',
  'Srbija': 'üá∑üá∏',
  '≈†vajcarska': 'üá®üá≠',
  'Urugvaj': 'üá∫üáæ',
  'Australija': 'üá¶üá∫',
  'ƒåile': 'üá®üá±',
  'Egipat': 'üá™üá¨',
  'Estonija': 'üá™üá™',
  'Etiopija': 'üá™üáπ',
  'Finska': 'üá´üáÆ',
  'Francuska': 'üá´üá∑',
  'Hrvatska': 'üá≠üá∑',
  'Island': 'üáÆüá∏',
  'Izrael': 'üáÆüá±',
  'Ju≈æna Koreja': 'üá∞üá∑',
  'Letonija': 'üá±üáª',
  'Norve≈°ka': 'üá≥üá¥',
  'Portugal': 'üáµüáπ',
  'SAD': 'üá∫üá∏',
  'Severna Irska': 'üá¨üáß',
  '≈†vedska': 'üá∏üá™',
  'Tajland': 'üáπüá≠',
  'Armenija': 'üá¶üá≤',
  'Azerbejd≈æan': 'üá¶üáø',
  'Banglade≈°': 'üáßüá©',
  'Belorusija': 'üáßüáæ',
  'BiH': 'üáßüá¶',
  'Bolivija': 'üáßüá¥',
  'Kostarika': 'üá®üá∑',
  'Ekvador': 'üá™üá®',
  'Farska Ostrva': 'üá´üá¥',
  'Gana': 'üá¨üá≠',
  'Grƒçka': 'üá¨üá∑',
  'Gvatemala': 'üá¨üáπ',
  'Indonezija': 'üáÆüá©',
  'Iran': 'üáÆüá∑',
  'Irak': 'üáÆüá∂',
  'Irska': 'üáÆüá™',
  'Kanada': 'üá®üá¶',
  'Kazahstan': 'üá∞üáø',
  'Kipar': 'üá®üáæ',
  'Kolumbija': 'üá®üá¥',
  'Malta': 'üá≤üáπ',
  'Nikaragva': 'üá≥üáÆ',
  'Panama': 'üáµüá¶',
  'Paragvaj': 'üáµüáæ',
  'Peru': 'üáµüá™',
  'Katar': 'üá∂üá¶',
  'Rumunija': 'üá∑üá¥',
  'Salvador': 'üá∏üáª',
  'Slovaƒçka': 'üá∏üá∞',
  'Slovenija': 'üá∏üáÆ',
  'UAE': 'üá¶üá™',
  'Uganda': 'üá∫üá¨',
  'Ukrajina': 'üá∫üá¶',
  'Uzbekistan': 'üá∫üáø',
  'Vels': 'üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø',
  'Afrika': 'üåç',
  'CONCACAF': 'üåé',
  'Ju≈æna Amerika': 'üèÜ',
  'Meƒëunarodne': 'üåê',
  'Ostalo': 'üìÅ'
};

// Funkcija koja kreira link element za kladionicu
function makeBookmakerLink(bookName) {
  if (!bookName) return '';
  
  const normalized = bookName.toLowerCase().trim();
  const url = BOOKMAKER_URLS[normalized];
  
  if (url) {
    return `<a href="${url}" target="_blank" rel="noopener noreferrer">${bookName}</a>`;
  }
  return bookName;
}

// Funkcija za normalizaciju naziva lige (spaja duplikate)
function normalizeLeagueName(leagueName) {
  if (!leagueName) return leagueName;
  
  // Mapa sinonima - sve varijacije koje treba tretirati kao istu ligu
  const synonyms = {
    // Poljska
    'Polish - II Liga': 'Poljska 2',
    'Polish - III Liga': 'Poljska 3',
    'Polish - IV Liga': 'Poljska 4',
    
    // Engleska
    'English - Championship': 'Engleska 2',
    'England, Championship': 'Engleska 2',
    'English - Premier League': 'Engleska 1',
    'English - EFL Cup': 'Engleska Kup',
    
    // Nemaƒçka
    'German - Bundesliga': 'Nemaƒçka 1',
    'German - DFB Pokal': 'Nemaƒçka Kup',
    'Germany, Regionalliga Bayern': 'Nemaƒçka 4 Bavarija',
    'German - Regionalliga Bayern': 'Nemaƒçka 4 Bavarija',
    'Germany, Regionalliga Nordost': 'Nemaƒçka 4 Severoistok',
    'German - Regionalliga Nordost': 'Nemaƒçka 4 Severoistok',
    'Germany, Regionalliga North': 'Nemaƒçka 4 Sever',
    'German - Regionalliga Nord': 'Nemaƒçka 4 Sever',
    'Germany, Regionalliga Sudwest': 'Nemaƒçka 4 Jugozapad',
    'German - Regionalliga Sudwest': 'Nemaƒçka 4 Jugozapad',
    'Germany, Regionalliga West': 'Nemaƒçka 4 Zapad',
    'German - Regionalliga West': 'Nemaƒçka 4 Zapad',
    
    // Italija
    'Italian - Serie A': 'Italija 1',
    'Italian - Serie B': 'Italija 2',
    'Italian - Coppa Italia': 'Italija Kup',
    'ITALY, Serie C - Group A': 'Italija 3 - Grupa A',
    'Italy, Serie C - Group A': 'Italija 3 - Grupa A',
    'ITALY, Serie C - Group C': 'Italija 3 - Grupa C',
    
    // ≈†panija
    'Spanish - La Liga': '≈†panija 1',
    
    // Turska
    'Turkish - Super Lig': 'Turska 1',
    'Turkey, Super Lig': 'Turska 1',
    'Turkish - First League': 'Turska 2',
    
    // Austrija
    'Austrian - Bundesliga': 'Austrija 1',
    'Austrian - First League': 'Austrija 2',
    'Austrian - OFB Cup': 'Austrija Kup',
    
    // Brazil
    'Brazilian - Serie A': 'Brazil 1',
    'Brazilian - Serie B': 'Brazil 2',
    
    // Bugarska
    'Bulgarian - First League': 'Bugarska 1',
    'Bulgarian - Second League': 'Bugarska 2',
    'Bulgaria, Vtora Liga': 'Bugarska 2',
    
    // ƒåe≈°ka
    'Czech - National League': 'ƒåe≈°ka 1',
    'Czech Republic, ChNL': 'ƒåe≈°ka 1',
    'Czech - CFL': 'ƒåe≈°ka 2',
    'Czech Republic, MSFL': 'ƒåe≈°ka 2',
    
    // Danska
    'Danish - Danish Cup': 'Danska Kup',
    
    // Holandija
    'Dutch - Eredivisie': 'Holandija 1',
    'Dutch - Eerste Divisie': 'Holandija 2',
    'Netherlands, Eerste Divisie': 'Holandija 2',
    'Dutch - Tweede Divisie': 'Holandija 3',
    
    // ≈†kotska
    'Scottish - Premiership': '≈†kotska 1',
    'Scottish - League Two': '≈†kotska 3',
    
    // Belgija
    'Belgian - First Division A': 'Belgija 1',
    'Belgian - First Division B': 'Belgija 2',
    'Belgium, Challenger Pro League': 'Belgija 2',
    
    // ≈†vedska
    'Swedish - Allsvenskan': '≈†vedska 1',
    'Swedish - Superettan': '≈†vedska 2',
    'Sweden, Superettan': '≈†vedska 2',
    
    // Norve≈°ka
    'Norwegian - Eliteserien': 'Norve≈°ka 1',
    'Norwegian - First Division': 'Norve≈°ka 2',
    
    // Rusija
    'Russian - Premier League': 'Rusija 1',
    'Russian - FNL': 'Rusija 2',
    'Russia, FNL': 'Rusija 2',
    'Russian - Cup': 'Rusija Kup',
    
    // Izrael
    'Israeli - Ligat HaAl': 'Izrael 1',
    'Israeli - Liga Leumit': 'Izrael 2',
    'Israel, Leumit League': 'Izrael 2',
    
    // Finska
    'Finnish - Veikkausliiga': 'Finska 1',
    'FINLAND, Veikkausliiga - Championship Group': 'Finska 1',
    
    // Hrvatska
    'Croatia, Prva NL': 'Hrvatska 1',
    
    // Tajland
    'Thailand, Thai Premier League': 'Tajland 1',
    
    // Australija
    'Australian - A-League': 'Australija 1',
    'Australia, A-League': 'Australija 1',
    'Australian - Australian Championship': 'Australija 2',
    
    // Litvanija
    'Lithuanian - A Lyga': 'Litvanija 1',
    'Lithuania, A Lyga': 'Litvanija 1',
    'Lithuania, I Lyga': 'Litvanija 2',
    
    // Kina
    'China, Super League': 'Kina 1',
    'Chinese - League Two': 'Kina 2',
    
    // Maƒëarska
    'Hungarian - NB I': 'Maƒëarska 1',
    'Hungarian - NB II': 'Maƒëarska 2',
    'MAƒê1': 'Maƒëarska 1',
    
    // Egipat
    'Egyptian - Premier League': 'Egipat 1',
    'Egyptian - Second Division': 'Egipat 2',
    
    // Estonija
    'Estonian - Esiliiga': 'Estonija 2',
    'Estonia, Esiliiga': 'Estonija 2',
    
    // Letonija
    'Latvian - Virsliga': 'Letonija 1',
    
    // Azerbejd≈æan
    'Azerbaijani - Premier League': 'Azerbejd≈æan 1',
    'Azerbaijani - First Division': 'Azerbejd≈æan 2',
    'Azerbaijan, Division One': 'Azerbejd≈æan 2',
    
    // BiH
    'Bosnian - Premier League': 'BiH 1',
    'Bosnian - First League': 'BiH 2',
    
    // Ukrajina
    'Ukrainian - Premier League': 'Ukrajina 1',
    'Ukraine, Premier League': 'Ukrajina 1',
    
    // Irska
    'Ireland, Premier Division': 'Irska 1',
    
    // Ekvador
    'Ecuadorian - Primera Serie B': 'Ekvador 2',
    'Ecuador, Liga Pro - Championship Group': 'Ekvador 1',
    
    // ƒåile
    'Chilean - Primera B': 'ƒåile 2',
    'ƒåIL1': 'ƒåile 1',
    
    // Kostarika
    'Costa Rican - Segunda Division': 'Kostarika 2',
    
    // Peru
    'Peruvian - Primera Division': 'Peru 1',
    
    // Paragvaj
    'Paraguayan - Primera Division': 'Paragvaj 1',
    
    // Salvador
    'Salvadoran - Primera Division': 'Salvador 1',
    
    // Nikaragva
    'Nicaraguan - Primera Division': 'Nikaragva 1',
    
    // Panama
    'Panamanian - LPF': 'Panama 1',
    
    // Gvatemala
    'Guatemalan - Liga Nacional': 'Gvatemala 1',
    
    // Urugvaj
    'Uruguayan - Segunda Division': 'Urugvaj 2',
    
    // Iran
    'Iranian - Gulf Pro League': 'Iran 1',
    'Iran, Persian Gulf Pro League': 'Iran 1',
    
    // Kazahstan
    'Kazakhstani - Premier League': 'Kazahstan 1',
    
    // Katar
    'Qatari - Stars League': 'Katar 1',
    'Qatari - Qatar Olympic League': 'Katar 2',
    
    // Rumunija
    'Romanian - Cup': 'Rumunija Kup',
    
    // Malta
    'Maltese - Premier League': 'Malta 1',
    
    // Gana
    'Ghana, Premier League': 'Gana 1',
    
    // Uganda
    'Uganda, Premier League': 'Uganda 1',
    
    // Etiopija
    'Ethiopian - Premier League': 'Etiopija 1',
    'Ethiopia, Premier League': 'Etiopija 1',
    
    // Vels
    'Welsh - Premier League': 'Vels 1',
    
    // Armenija
    'Armenia, Premier League': 'Armenija 1',
    
    // SAD
    'USA - Major League Soccer': 'SAD 1',
    'USA - United Soccer League': 'SAD 2',
    
    // Evropa
    'European - Champions League': 'Liga ≈†ampiona',
    'European - Europa League': 'Liga Evrope',
    'European - Conference League': 'Liga Konferencija',
    'UEFA, Conference League - League phase': 'Liga Konferencija',
    'European - UEFA Youth League': 'UEFA Liga Mladih',
    
    // Afrika
    'African - CAF Champions League': 'Afrika Liga ≈†ampiona',
    'AFC Liga ≈†ampiona 2': 'Afrika Liga ≈†ampiona',
    'African - CAF Confederation Cup': 'Afrika Kup Konfederacija',
    
    // CONCACAF
    'North American - CONCACAF Caribbean Cup': 'KONKAKAF Kup Kariba',
    'International Clubs, CONCACAF Central American Cup - Play Offs': 'KONKAKAF Cen.Ameriƒçki Kup',
    
    // Ju≈æna Amerika
    'South American - Copa Sudamericana': 'Kup Sudamerikana',
    
    // Meƒëunarodne
    'World - International Friendly': 'Prijateljske utakmice',
    'World - International Friendly Women': 'Prijateljske utakmice ≈Ωene'
  };
  
  return synonyms[leagueName] || leagueName;
}

// === Parser (robustan datum/vreme/lig–∞) ===
function parseBlock(txt){
  const parts = txt.split(/\r?\n-{5,}\r?\n/).map(s=>s.trim()).filter(Boolean);
  return parts.map(block=>{
    const lines = block.split(/\r?\n/).map(s=>s.replace(/\r/g,'')).filter(l=>l.trim()!=='');
    const headLines = lines.filter(l=> !l.trim().startsWith('- ') && !/^Najveƒáa/i.test(l) && !/^Arbitra≈æa/i.test(l) );

    // uzmi iz prve 2-3 linije (radi i za "00:30   22.10." i obrnuto)
    const top3 = lines.slice(0,3).join(' ');
    const time   = (top3.match(/(\d{1,2}:\d{2})/) || [])[1] || '';
    const date   = (top3.match(/(\d{1,2}\.\d{1,2}\.(?:\d{2,4}\.)?)/) || [])[1] || '';
    const league = (top3.match(/\[(.+?)\]/) || [])[1] || '';

    // timovi (linija sa "vs")
    const teamsLine = (lines.find(l=> /\bvs\b/i.test(l)) || headLines[1] || '').trim();
    const teams = teamsLine.replace(/\s+/g,' ');

    // kladionice
    const bookRows = lines.filter(l=> l.trim().startsWith('- ') );
    const rows = [];
    for(const r of bookRows){
      const m = r.replace(/^- /,'').trim();
      
      // Preskoƒçi prazne kao "Brazil_d   -"
      if(m === '-' || !m.includes('=')) continue;
      
      const bName = m.split(/\s{2,}/)[0].trim();
      const pairs = m.slice(bName.length).split('|').map(s=>s.trim()).filter(Boolean);
      const markets = {};
      for(const p of pairs){
        const mm = p.match(/^([A-Za-z0-9+&IGG-]+)\s*=\s*([0-9.]+)$/);
        if(mm){ markets[mm[1]] = parseFloat(mm[2]); }
      }
      
      // Dodaj samo ako ima kvota
      if(Object.keys(markets).length > 0){
        rows.push({book:bName, markets});
      }
    }
    return { time, date, league, teams, rows, raw:block };
  });
}

// === Pomoƒáne ===
function bestByMarket(rows, m){ let best={book:null,val:null}; for(const r of rows){ const v=r.markets[m]; if(typeof v==="number" && (!best.val||v>best.val)) best={book:r.book, val:v}; } return best; }
function arbitraza(rows){ const b1=bestByMarket(rows,'1').val, bX=bestByMarket(rows,'X').val, b2=bestByMarket(rows,'2').val; if(!b1||!bX||!b2) return {inv:null,profit:null,ok:false}; const inv=1/b1+1/bX+1/b2; return {inv,profit:(1-inv)*100,ok:inv<1}; }
function arbitraza02(rows, a='0-2', b='3+'){ const ba=bestByMarket(rows,a).val, bb=bestByMarket(rows,b).val; if(!ba||!bb) return {inv:null,profit:null,ok:false}; const inv=1/ba+1/bb; return {inv,profit:(1-inv)*100,ok:inv<1}; }
function scaleByMarket(rows, m){ const vals=rows.map(r=>r.markets[m]).filter(v=>typeof v==="number"); if(!vals.length) return ()=>0; const min=Math.min(...vals), max=Math.max(...vals); return v=> typeof v==="number" ? ((v-min)/Math.max(1e-9,(max-min))) : 0; }

// === Render ===
function render(data){
  const out = document.getElementById('out'); out.innerHTML = '';
  const sortVal = document.getElementById('sort').value;
  const withArb = data.map(m=> ({...m, arb: arbitraza(m.rows), arb02: arbitraza02(m.rows)}));
  if(sortVal==='arbdesc')    withArb.sort((a,b)=> (b.arb?.profit??-1e9)  - (a.arb?.profit??-1e9));
  if(sortVal==='arbasc')     withArb.sort((a,b)=> (a.arb?.profit??1e9)   - (b.arb?.profit??1e9));
  if(sortVal==='arb02desc')  withArb.sort((a,b)=> (b.arb02?.profit??-1e9)- (a.arb02?.profit??-1e9));
  if(sortVal==='arb02asc')   withArb.sort((a,b)=> (a.arb02?.profit??1e9) - (b.arb02?.profit??1e9));

  const q = document.getElementById('q').value.toLowerCase().trim();
  const filtered = withArb.filter(m=> {
    const txt = (m.teams+' '+m.league).toLowerCase();
    if(q && !txt.includes(q)) return false;
    // Normalizuj naziv lige za poreƒëenje
    const normalizedMatchLeague = normalizeLeagueName(m.league);
    if(window.selectedLeague && normalizedMatchLeague !== window.selectedLeague) return false;
    return true;
  });

  for(const m of filtered){
    if(!m.rows || !m.rows.length) continue;

    const card = document.createElement('div'); card.className='match';
    const head=document.createElement('div'); head.className='head';
    const left=document.createElement('div'); left.style.display='flex'; left.style.flexDirection='column';

    // Datum i vreme iznad timova
    const datetime=document.createElement('div'); datetime.className='sub';
    const when=[(m.date||'').trim(), (m.time||'').trim()].filter(Boolean).join(' ');
    datetime.textContent = when;
    
    const title=document.createElement('div'); title.className='teams'; title.textContent = m.teams;
    const sub=document.createElement('div'); sub.className='sub'; sub.textContent = m.league;
    left.appendChild(datetime); left.appendChild(title); left.appendChild(sub); head.appendChild(left);

    const meta=document.createElement('div'); meta.className='meta';
    const badge=document.createElement('span'); badge.className='pill ' + (m.arb.ok?'good':'bad');
    badge.textContent=m.arb.inv? `Arbitra≈æa (1-X-2): ${m.arb.ok?'DA':'NE'} ¬∑ inv=${m.arb.inv.toFixed(4)} ¬∑ profit‚âà${m.arb.profit.toFixed(2)}%` : 'Arbitra≈æa (1-X-2): ‚Äî';
    const badge2=document.createElement('span'); badge2.className='pill ' + (m.arb02.ok?'good':'bad');
    badge2.textContent=m.arb02.inv? `Arbitra≈æa (0-2/3+): ${m.arb02.ok?'DA':'NE'} ¬∑ inv=${m.arb02.inv.toFixed(4)} ¬∑ profit‚âà${m.arb02.profit.toFixed(2)}%` : 'Arbitra≈æa (0-2/3+): ‚Äî';
    meta.appendChild(badge); meta.appendChild(badge2); head.appendChild(meta); card.appendChild(head);

    const body=document.createElement('div'); body.className='body';
    const b1=bestByMarket(m.rows,'1'), bX=bestByMarket(m.rows,'X'), b2=bestByMarket(m.rows,'2');
    const stats=document.createElement('div'); stats.className='stats';
    
    // Stats sa linkovima
    stats.innerHTML=[ ['Najveƒáa 1',b1],['Najveƒáa X',bX],['Najveƒáa 2',b2] ].map(([lab,b])=>{
      const bookLink = makeBookmakerLink(b.book);
      return `<div class="stat"><h4>${lab}</h4><div class="big">${b.val??'‚Äî'}</div><div class="bk">${bookLink}</div><div class="barwrap"><div class="bar" style="width:${b.val? Math.min(100,(100*Math.pow((b.val/(Math.max(b1.val||0,bX.val||0,b2.val||0)||1)),.8))).toFixed(0):0}%; background:linear-gradient(90deg, var(--accent), var(--accent-2))"></div></div></div>`;
    }).join('');
    body.appendChild(stats);

    const mkts=Array.from(new Set(m.rows.flatMap(r=>Object.keys(r.markets)))).sort((a,b)=>{const order=['1','X','2','0-2','2+','3+','GG','IGG','GG&3+','GG&4+','4+']; const ia=order.indexOf(a), ib=order.indexOf(b); return (ia===-1?999:ia)-(ib===-1?999:ib);});
    const bestMap=Object.fromEntries(mkts.map(k=>[k,bestByMarket(m.rows,k).val]));
    const scalers=Object.fromEntries(mkts.map(k=>[k,scaleByMarket(m.rows,k)]));

    const tbl=document.createElement('table'); const thead=document.createElement('thead');
    thead.innerHTML=`<tr><th>Bookmaker</th>${mkts.map(mk=>`<th>${mk}</th>`).join('')}</tr>`; tbl.appendChild(thead);
    const tb=document.createElement('tbody');
    for(const r of m.rows){
      const tr=document.createElement('tr');
      
      // Link za kladionicu
      const bookLink = makeBookmakerLink(r.book);
      
      tr.innerHTML=`<td>${bookLink}</td>` + mkts.map(k=>{ 
        const v=r.markets[k]; 
        const isBest=v && bestMap[k]===v; 
        const p=scalers[k](v)*100; 
        
        // Padding za poravnanje
        let paddingRight = '12px';
        if(v){
          const vStr = v.toString();
          const decimalPos = vStr.indexOf('.');
          if(decimalPos === -1){
            paddingRight = '36px'; // nema decimale
          } else {
            const decimals = vStr.length - decimalPos - 1;
            if(decimals === 1){
              paddingRight = '24px'; // jedna decimala
            }
          }
        }
        
        const cell=`<span class="cell ${isBest?'best':''}" style="padding-right:${paddingRight}">${v??''}</span>`; 
        return `<td class="num">${cell}<div class="barwrap"><div class="bar" style="width:${p.toFixed(0)}%; background:linear-gradient(90deg, ${isBest?'#8af5c8,#7c9aff':'#434d8b,#2e365f'})"></div></div></td>`; 
      }).join('');
      tb.appendChild(tr);
    }
    tbl.appendChild(tb); body.appendChild(tbl);

    const ft=document.createElement('div'); ft.className='footer'; ft.innerHTML=`<span class="muted">Ukupno kladionica: <b>${m.rows.length}</b></span>`; body.appendChild(ft);

    card.appendChild(body); out.appendChild(card);
  }
  
  // A≈æuriraj sidebar sa ligama
  updateLeagueSidebar(data);
}

function updateLeagueSidebar(data){
  const leagueList = document.getElementById('leagueList');
  if(!leagueList) return;
  
  // Grupi≈°i utakmice po zemljama i normalizovanim ligama
  const countryGroups = {};
  const leagueCounts = {};
  const leagueOriginalNames = {}; // ƒåuva originalne nazive za prikaz
  
  for(const m of data){
    const originalLeague = m.league ? m.league : '(bez lige)';
    const normalizedLeague = normalizeLeagueName(originalLeague);
    
    // ƒåuvaj prvi originalni naziv koji se pojavi za normalizovanu ligu
    if(!leagueOriginalNames[normalizedLeague]) {
      leagueOriginalNames[normalizedLeague] = originalLeague;
    }
    
    leagueCounts[normalizedLeague] = (leagueCounts[normalizedLeague] || 0) + 1;
    
    const country = getCountryForLeague(originalLeague);
    if(!countryGroups[country]) countryGroups[country] = {};
    countryGroups[country][normalizedLeague] = (countryGroups[country][normalizedLeague] || 0) + 1;
  }
  
  leagueList.innerHTML = '';
  
  // "Sve lige" opcija
  const allItem = document.createElement('div');
  allItem.className = 'league-item' + (!window.selectedLeague ? ' active' : '');
  allItem.innerHTML = `üåç Sve lige <span class="league-count">${data.length}</span>`;
  allItem.onclick = ()=>{
    window.selectedLeague = null;
    render(currentData);
  };
  leagueList.appendChild(allItem);
  
  // Sortiraj zemlje po broju utakmica, ali Ostalo stavi na kraj
  const sortedCountries = Object.entries(countryGroups).sort((a,b)=> {
    // Ako je jedno od njih "Ostalo", stavi ga na kraj
    if (a[0] === 'Ostalo') return 1;
    if (b[0] === 'Ostalo') return -1;
    
    const countA = Object.values(a[1]).reduce((sum, val) => sum + val, 0);
    const countB = Object.values(b[1]).reduce((sum, val) => sum + val, 0);
    return countB - countA;
  });
  
  // Kreiraj grupisane lige
  for(const [country, leagues] of sortedCountries){
    const countryTotal = Object.values(leagues).reduce((sum, val) => sum + val, 0);
    const flag = COUNTRY_FLAGS[country] || 'üè≥Ô∏è';
    
    // Header za zemlju
    const countryHeader = document.createElement('div');
    countryHeader.style.cssText = 'margin-top:16px; padding:8px 12px; font-size:12px; font-weight:700; color:var(--accent); text-transform:uppercase; letter-spacing:.8px; cursor:pointer; border-radius:8px; transition:.2s all;';
    countryHeader.innerHTML = `${flag} ${country} <span style="opacity:.7; font-size:10px; float:right;">${countryTotal}</span>`;
    countryHeader.onmouseover = () => countryHeader.style.background = 'rgba(107,138,255,0.1)';
    countryHeader.onmouseout = () => countryHeader.style.background = 'transparent';
    leagueList.appendChild(countryHeader);
    
    // Sortiraj lige abecedno
    const sortedLeagues = Object.entries(leagues).sort((a,b)=> a[0].localeCompare(b[0]));
    
    // Liga items
    for(const [normalizedLeague, count] of sortedLeagues){
      const item = document.createElement('div');
      item.className = 'league-item' + (window.selectedLeague === normalizedLeague ? ' active' : '');
      item.style.marginLeft = '8px';
      item.innerHTML = `${normalizedLeague} <span class="league-count">${count}</span>`;
      item.onclick = ()=>{
        window.selectedLeague = normalizedLeague;
        render(currentData);
      };
      leagueList.appendChild(item);
    }
  }
}

// === Auto uƒçitavanje svakih 10s iz DEFAULT_FILE ===
const srcEl=document.getElementById('src');
const pillStatus=document.getElementById('pillStatus');
const qEl=document.getElementById('q');
const sortEl=document.getElementById('sort');

function setStatus(txt, ok=true){
  pillStatus.textContent = txt;
  pillStatus.className = 'pill ' + (ok ? 'good' : 'bad');
}

async function fetchAndRender(){
  try{
    const url = `${DEFAULT_FILE}?cb=${Date.now()}&r=${Math.random()}`;
    const started = new Date();
    const resp = await fetch(url, {
      cache:'no-store',
      headers: {
        'Cache-Control': 'no-cache, no-store, must-revalidate',
        'Pragma': 'no-cache',
        'Expires': '0'
      }
    });
    if(!resp.ok) throw new Error('HTTP '+resp.status);
    const text = await resp.text();
    srcEl.value = text; srcEl.readOnly = true;
    
    currentData = parseBlock(text);
    render(currentData);
    
    const t = new Date();
    const hh = t.toLocaleTimeString(undefined, {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    setStatus(`Uƒçitano OK u ${hh} (${((t-started)/1000).toFixed(1)}s)`, true);
  }catch(err){
    const t = new Date();
    const hh = t.toLocaleTimeString(undefined, {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    setStatus(`Gre≈°ka u ${hh}: ${err.message}`, false);
    console.error('Gre≈°ka:', err);
  }
}

// Filter/sort osve≈æavaju prikaz bez novog fetch-a
[qEl, sortEl].forEach(el=>{
  el.addEventListener('input', ()=>{ render(currentData); });
  el.addEventListener('change', ()=>{ render(currentData); });
});

document.getElementById('btnPrint').onclick = ()=> window.print();

// Start: odmah uƒçitaj, pa svakih 5 minuta ponovi
window.addEventListener('DOMContentLoaded', ()=>{
  fetchAndRender();
  setInterval(fetchAndRender, AUTO_INTERVAL_MS);
});
</script>
</body>
</html>